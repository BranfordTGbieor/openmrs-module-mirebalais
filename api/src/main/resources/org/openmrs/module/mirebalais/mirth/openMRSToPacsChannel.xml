<connector>
  <name>sourceConnector</name>
  <properties>
    <property name="DataType">Database Reader</property>
    <property name="URL">jdbc:mysql://localhost:3306/openmrs?autoReconnect=true&amp;sessionVariables=storage_engine=InnoDB&amp;useUnicode=true&amp;characterEncoding=UTF-8</property>
    <property name="ack">UPDATE pacsintegration_outbound_queue SET processed=1
			WHERE outbound_queue_id=${outbound_queue_id};</property>
    <property name="ackScript"></property>
    <property name="driver">com.mysql.jdbc.Driver</property>
    <property name="host">query</property>
    <property name="password">morrison</property>
    <property name="pollingFrequency">5000</property>
    <property name="pollingType">interval</property>
    <property name="processResultsInOrder">1</property>
    <property name="query">SELECT outbound_queue_id, message FROM pacsintegration_outbound_queue
                WHERE processed=0 ORDER BY date_created ASC;

            </property>
    <property name="script"></property>
    <property name="useAck">1</property>
    <property name="useScript">0</property>
    <property name="username">root</property>
  </properties>
  <transformer>
    <steps>
      <step>
        <sequenceNumber>0</sequenceNumber>
        <name>Message Header - Sending Facility - Value (MSH.4.1) (out) &lt;-- sendingFacility (in)</name>
        <script>tmp[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;sendingFacility&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;MSH&apos;][&apos;MSH.4&apos;][&apos;MSH.4.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;sendingFacility&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>1</sequenceNumber>
        <name>Patient Identification - Patient ID (Internal ID) - ID Number (PID.3.1) (out) &lt;-- patientId (in)</name>
        <script>tmp[&apos;PID&apos;][&apos;PID.3&apos;][&apos;PID.3.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;patientId&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;PID&apos;][&apos;PID.3&apos;][&apos;PID.3.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;patientId&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>2</sequenceNumber>
        <name>Patient Identification - Patient Name - Family Name (PID.5.1) (out) &lt;-- familyName (in)</name>
        <script>tmp[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;familyName&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;familyName&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>3</sequenceNumber>
        <name>Patient Identification - Patient Name - Given Name (PID.5.2) (out) &lt;-- givenName (in)</name>
        <script>tmp[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.2&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;givenName&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;PID&apos;][&apos;PID.5&apos;][&apos;PID.5.2&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;givenName&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>4</sequenceNumber>
        <name>Patient Identification - Date of Birth - Value (PID.7.1) (out) &lt;-- dateOfBirth (in)</name>
        <script>tmp[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;dateOfBirth&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;PID&apos;][&apos;PID.7&apos;][&apos;PID.7.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;dateOfBirth&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>5</sequenceNumber>
        <name>Patient Identification - Sex - Value (PID.8.1) (out) &lt;-- patientSex (in)</name>
        <script>tmp[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;patientSex&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;PID&apos;][&apos;PID.8&apos;][&apos;PID.8.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;patientSex&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>6</sequenceNumber>
        <name>Common Order - Order Control - Value (ORC.1.1) (out) &lt;-- orderControl (in)</name>
        <script>tmp[&apos;ORC&apos;][&apos;ORC.1&apos;][&apos;ORC.1.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;orderControl&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;ORC&apos;][&apos;ORC.1&apos;][&apos;ORC.1.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;orderControl&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>7</sequenceNumber>
        <name>Observation Request - Fillers Order # - Field1 (OBR.3.1) (out) &lt;-- accessionNumber (in)</name>
        <script>tmp[&apos;OBR&apos;][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;accessionNumber&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;OBR&apos;][&apos;OBR.3&apos;][&apos;OBR.3.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;accessionNumber&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>8</sequenceNumber>
        <name>Observation Request - Universal Service ID - Identifier (OBR.4.1) (out) &lt;-- universalServiceID (in)</name>
        <script>tmp[&apos;OBR&apos;][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;universalServiceID&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;OBR&apos;][&apos;OBR.4&apos;][&apos;OBR.4.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;universalServiceID&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>9</sequenceNumber>
        <name>Observation Request - Universal Service ID - Text (OBR.4.2) (out) &lt;-- universalServiceIDText (in)</name>
        <script>tmp[&apos;OBR&apos;][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;universalServiceIDText&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;OBR&apos;][&apos;OBR.4&apos;][&apos;OBR.4.2&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;universalServiceIDText&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>10</sequenceNumber>
        <name>Observation Request - Placers Field #2 - Value (OBR.19.1) (out) &lt;-- deviceLocation (in)</name>
        <script>tmp[&apos;OBR&apos;][&apos;OBR.19&apos;][&apos;OBR.19.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;deviceLocation&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;OBR&apos;][&apos;OBR.19&apos;][&apos;OBR.19.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;deviceLocation&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>11</sequenceNumber>
        <name>Observation Request - Placers Field #2 - OBR.19.2 (out) &lt;-- modality (in)</name>
        <script>tmp[&apos;OBR&apos;][&apos;OBR.19&apos;][&apos;OBR.19.2&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;modality&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;OBR&apos;][&apos;OBR.19&apos;][&apos;OBR.19.2&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;modality&apos;].toString()</string>
          </entry>
        </data>
      </step>
      <step>
        <sequenceNumber>12</sequenceNumber>
        <name>Observation Request - Scheduled Date/Time - Value (OBR.36.1) (out) &lt;-- scheduledExamDatetime (in)</name>
        <script>tmp[&apos;OBR&apos;][&apos;OBR.36&apos;][&apos;OBR.36.1&apos;] = validate(msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;scheduledExamDatetime&apos;].toString(), &apos;&apos;, new Array());</script>
        <type>Message Builder</type>
        <data class="map">
          <entry>
            <string>Variable</string>
            <string>tmp[&apos;OBR&apos;][&apos;OBR.36&apos;][&apos;OBR.36.1&apos;]</string>
          </entry>
          <entry>
            <string>DefaultValue</string>
            <string></string>
          </entry>
          <entry>
            <string>RegularExpressions</string>
            <list/>
          </entry>
          <entry>
            <string>Mapping</string>
            <string>msg[&apos;message&apos;][&apos;OrmMessage&apos;][&apos;scheduledExamDatetime&apos;].toString()</string>
          </entry>
        </data>
      </step>
    </steps>
    <inboundTemplate encoding="base64">PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxy
ZXN1bHQ+CiAgICA8b3V0Ym91bmRfcXVldWVfaWQ+dmFsdWU8L291dGJvdW5kX3F1ZXVlX2lkPgog
ICAgPG1lc3NhZ2U+dmFsdWU8L21lc3NhZ2U+CjwvcmVzdWx0Pgo=</inboundTemplate>
    <outboundTemplate encoding="base64">TVNIfF5+XCZ8fHx8fHx8T1JNXk8wMXx8UHwyLjJ8fHx8fApQSUR8fHw2NjUxMDU2MDl8fEtPTkde
S0lOR3x8MTkyNjA0MjUxMzQ2MzF8TXx8fHx8fHx8fHx8fHx8fHx8fHwKUFYxfHx8fHx8fHx8fHx8
fHx8fHx8Ck9SQ3xOV3x8fHx8fHx8fHx8fHx8fHx8fApPQlJ8fHwxMTU0NjE0MTgwQXw3NTUzNl5V
U0xJVkVSfHx8fHx8fHx8fHx8fHx8Uk0zNDVeVVN8fHx8fHx8fHx8fHx8fHx8fDIwMDAxMjI1</outboundTemplate>
    <inboundProtocol>XML</inboundProtocol>
    <outboundProtocol>HL7V2</outboundProtocol>
    <inboundProperties>
      <property name="stripNamespaces">true</property>
    </inboundProperties>
    <outboundProperties>
      <property name="convertLFtoCR">true</property>
      <property name="handleRepetitions">false</property>
      <property name="handleSubcomponents">false</property>
      <property name="stripNamespaces">true</property>
      <property name="useStrictParser">false</property>
      <property name="useStrictValidation">false</property>
    </outboundProperties>
  </transformer>
  <filter>
    <rules/>
  </filter>
  <transportName>Database Reader</transportName>
  <mode>SOURCE</mode>
  <enabled>true</enabled>
  <version>2.2.1.5861</version>
</connector>