<htmlform class="simple-form-ui2" formUuid="c18d68ce-a130-4460-8cdf-6fbfaa33487e" formName="Death certificate"
          formEncounterType="1545d7ff-60f1-485e-9c95-5740b8e6634b" formVersion="2.0">

    <translations defaultLocale="fr">
        <code name="death_certificate">
            <variant locale="en" value="Death certificate"/>
            <variant locale="fr" value="Certificat / Constat de deces"/>
        </code>
        <code name="death_details">
            <variant locale="en" value="Death Details"/>
            <variant locale="fr" value="Detailles du deces"/>
        </code>
        <code name="date_of_death">
            <variant locale="en" value="Date of Death"/>
            <variant locale="fr" value="TODO Date of Death"/>
        </code>
        <code name="data_collected_by">
            <variant locale="en" value="Data collected by"/>
            <variant locale="fr" value="Données recueillies par"/>
        </code>
        <code name="demographics">
            <variant locale="en" value="Demographics of deceased"/>
            <variant locale="fr" value=" Caracteristiques du defunt"/>
        </code>
        <code name="location">
            <variant locale="en" value="Place of death"/>
            <variant locale="fr" value="Lieu du deces"/>
        </code>
        <code name="gender">
            <variant locale="en" value="Gender"/>
            <variant locale="fr" value="Sexe"/>
        </code>
        <code name="birthdate">
            <variant locale="en" value="Birthdate"/>
            <variant locale="fr" value="Date de naissance"/>
        </code>
        <code name="name">
            <variant locale="en" value="Name"/>
            <variant locale="fr" value="Nom"/>
        </code>
        <code name="address">
            <variant locale="en" value="Home address"/>
            <variant locale="fr" value="Résidence"/>
        </code>
        <code name="habitat">
            <variant locale="en" value="Environment"/>
            <variant locale="fr" value="Habitat"/>
        </code>
        <code name="civil_status">
            <variant locale="en" value="Marital status"/>
            <variant locale="fr" value="État matrimonial"/>
        </code>
        <code name="dossier">
            <variant locale="en" value="Dossier Number"/>
            <variant locale="fr" value="Dossier No"/>
        </code>
        <code name="provider">
            <variant locale="en" value="Provider"/>
            <variant locale="fr" value="Clinicien"/>
        </code>
        <code name="maternal_death">
            <variant locale="en" value="Maternal death"/>
            <variant locale="fr" value="Décès maternel"/>
        </code>
        <code name="if_external">
            <variant locale="en" value="If outside institution"/>
            <variant locale="fr" value="Si extra institutionnel"/>
        </code>
        <code name="if_internal">
            <variant locale="en" value="If within institution"/>
            <variant locale="fr" value="Si institutionnel"/>
        </code>
        <code name="service">
            <variant locale="en" value="Service"/>
            <variant locale="fr" value="Service"/>
        </code>
        <code name="days_in_hospital">
            <variant locale="en" value="Hospital stay (in days)"/>
            <variant locale="fr" value="Durée d'hospitalisation (en jours)"/>
        </code>
        <code name="doctor_visit">
            <variant locale="en" value="Did the deceased visit health provider during this illness?"/>
            <variant locale="fr" value="Le défunt-a-t-il été vu par un personnel de santé au cours de cette maladie?"/>
        </code>
        <code name="yes_complete">
            <variant locale="en" value="If yes, complete certificate or report"/>
            <variant locale="fr" value="Si OUI, remplissez le certificat ou constat"/>
        </code>
        <code name="no_complete">
            <variant locale="en" value="If no, complete the circumstances section"/>
            <variant locale="fr" value="Si NON, remplissez la case ci-dessous"/>
        </code>
        <code name="info_source">
            <variant locale="en" value="Information source"/>
            <variant locale="fr" value="Source d'information"/>
        </code>
        <code name="circumstances">
            <variant locale="en" value="Circumstances of death"/>
            <variant locale="fr" value="Circonstances du décès"/>
        </code>
        <code name="clinical_exam">
            <variant locale="en" value="Clinical examination"/>
            <variant locale="fr" value="Examens paracliniques"/>
        </code>
        <code name="diagnosis_method">
            <variant locale="en" value="Method(s) to confirm diagnosis"/>
            <variant locale="fr" value="Moyen(s) de confirmation du diagnostic:"/>
        </code>
        <code name="certification_declaration">
            <variant locale="en" value="certified the death of the identified person"/>
            <variant locale="fr" value="certifie par la présente que la personne identifiée ci-dessus est décédée"/>
        </code>
        <code name="cause_of_death">
            <variant locale="en" value="Cause of death"/>
            <variant locale="fr" value="Cause du décès"/>
        </code>
        <code name="final_disease">
            <variant locale="en" value="Final disease or condition resulting in death"/>
            <variant locale="fr" value="Maladie ou ayant directement provoqué le décès"/>
        </code>
        <code name="due_to_or_following">
            <variant locale="en" value="caused by (or following)"/>
            <variant locale="en" value="due à (ou consécutive à)"/>
        </code>
        <code name="condition_caused_final_disease">
            <variant locale="en" value="Condition which caused the previous disease or condition"/>
            <variant locale="fr" value="Affections morbides ayant éventuellement conduit a l'état préciser l'affectation initiale étant indiquée en dernier lieu"/>
        </code>
        <code name="contributing_condition_title">
            <variant locale="en" value="Contributing condition"/>
            <variant locale="fr" value="Autre état morbide"/>
        </code>
        <code name="contributing_condition">
            <variant locale="en" value="Condition contributing to the death but not related to the disease or morbid condition"/>
            <variant locale="fr" value="Autre état morbide important ayant contribué au décès mais sans rapport avec la maladie ou l'état morbide qui l'a provoqué"/>
        </code>
        <code name="burial_certificate">
            <variant locale="en" value="Burial certificate number"/>
            <variant locale="fr" value="Permis d'inhumer : N°"/>
        </code>
        <code name="icd_code">
            <variant locale="en" value="ICD-10 Code"/>
            <variant locale="fr" value="CODE CIM-10"/>
        </code>
    </translations>

    <style class="text/css">
        @media print {
            div.patient-header {
                display: none;
            }
        }

        fieldset#institutional-view {
            float: left;
            width: 45%;
        }

        fieldset#extra-institutional-view {
            display: inline-block;
            width: 45%;
            vertical-align: top;
        }

        #permit {
            display: inline-block;
            width: 45%;
            margin-top: 20px;
            margin-left: 12px;
        }

        p.start-line {
            clear: left;
        }

        .one-quarter {
            display: inline-block;
            width: 22%;
            vertical-align: top;
        }

        .three-quarters {
            display: inline-block;
            width: 70%;
            vertical-align: top;
        }

        .one-third {
            display: inline-block;
            width: 30%;
            vertical-align: top;
        }

        .two-thirds {
            display: inline-block;
            width: 60%;
            vertical-align: top;
        }

        .one-half {
            display: inline-block;
            width: 46%;
            vertical-align: top;
        }

        .signature {
            color: blue;
            font-style: italic;
        }

        .value {
            font-weight: bold;
            color: blue;
        }

        .spaced {
            margin-top: 10px;
            margin-bottom: 10px;
        }

        label {
            font-size: 0.8em;
        }

        h4#title {
            text-align: center;
            border-top: 1px #a0a0a0 solid;
            border-bottom: 1px #a0a0a0 solid;
        }
    </style>

    <ifMode mode="VIEW">
        <lookup complexExpression="#set( $certificate = $fn.getObs($encounter, 'PIH: Visited provider during illness').valueCoded.equals($fn.getConcept('PIH: YES')) )"/>

        <h4 id="title">
            <uimessage code="death_certificate"/> - MSPP
        </h4>

        <section sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="demographics">
            <p>
                <label><uimessage code="name"/></label>
                <lookup class="value" expression="patient.personName"/>
            </p>
            <p class="one-third">
                <label><uimessage code="gender"/></label>
                <lookup class="value" expression="patient.gender"/>
            </p>
            <p class="one-third">
                <label>Age</label>
                <lookup class="value" expression="patient.age"/>
            </p>
            <p class="one-third">
                <label><uimessage code="birthdate"/></label>
                <lookup class="value" complexExpression="#if( \$patient.birthdateEstimated ) ~#end"/> <lookup class="value" expression="patient.birthdate"/>
            </p>
            <p>
                <label><uimessage code="address"/></label>
                <lookup class="value" complexExpression="#foreach( $addr in $patient.addresses ) Départment: $!addr.stateProvince , Commune: $!addr.cityVillage &lt;br/&gt;#end"/>
            </p>
            <p class="one-third">
                <label><uimessage code="civil_status"/></label>
                <obs conceptId="PIH: CIVIL STATUS"/>
            </p>
            <p class="one-half">
                <label>Occupation</label>
                <obs conceptId="PIH: Occupation"/>
            </p>
            <p class="one-quarter">
                <label><uimessage code="maternal_death"/></label>
                <obs conceptId="PIH: Maternal death"/>
            </p>
        </section>

        <section id="location" sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="location">
            <p class="one-half">
                <includeIf velocityTest="$fn.getObs($encounter, 'PIH: Location of death').valueCoded.equals($fn.getConcept('PIH: Home')) || $fn.getObs($encounter, 'PIH: Location of death').valueCoded.equals($fn.getConcept('PIH: OTHER NON-CODED'))">
                    <span class="value">[X] <lookup expression="fn.getConcept('PIH: Outside of institution').name"/></span>
                </includeIf>
            </p>
            <p class="one-half">
                <obs id="institutional-death-span" conceptId="PIH: Location of death" answerConceptId="PIH: HOSPITAL"/>
            </p>
            <p class="one-quarter">
                <label><uimessage code="if_external"/></label>
            </p>
            <p class="three-quarters">
                <span class="one-third">
                    <obs conceptId="PIH: Location of death" answerConceptId="PIH: Home"/>
                </span>
                <span class="two-thirds">
                    <obs conceptId="PIH: Location of death" answerConceptId="PIH: OTHER NON-CODED"/>
                    <obsTODO conceptId="PIH: Location of death non coded"/>
                </span>
            </p>
            <p class="one-quarter">
                <label><uimessage code="if_internal"/></label>
            </p>
            <p class="three-quarters">
                <span class="one-half">
                    Institution:
                    <includeIf velocityTest="$fn.getObs($encounter, 'PIH: Location of death').valueCoded.equals($fn.getConcept('PIH: HOSPITAL'))">
                        <span class="value">UHM</span>
                    </includeIf>
                </span>
                <span class="one-half">
                    Service: <obsTODO conceptId="PIH: Location of institutional death" style="location"/>
                </span>
            </p>
            <p class="two-thirds">
                <label><uimessage code="days_in_hospital"/></label>
                <obs conceptId="PIH: Duration of hospitalization"/> TODO change this
            </p>
            <p class="one-third">
                <label>ZL EMR ID:</label>
                <lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('ZL EMR ID') ) $patId #end "/>
                <br/>
                <label><uimessage code="dossier"/></label>
                <lookup class="value" complexExpression="#foreach( $patId in $patientIdentifiers.get('Nimewo Dosye') ) $patId #end "/>
            </p>
        </section>

        <section id="care" sectionTag="div" headerTag="div" headerStyle="" headerCode="">
            <p class="spaced">
                <label><uimessage code="doctor_visit"/></label>
                <obs conceptId="PIH: Visited provider during illness"/><br/>
            </p>
        </section>

        <section id="institutional-view" sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="death_certificate">
            <p>
                <label>Je soussigné</label>
                <includeIf velocityTest="$certificate">
                    <span class="signature">
                        <encounterProviderAndRole encounterRole="4f10ad1a-ec49-48df-98c7-1391c6ac7f05"/>
                    </span>
                </includeIf>
            </p>
            <p>
                TODO Doctor, Nurse, or Other
            </p>
            <p>
                <label>
                    certifie par la présente que la personne identifiée ci-dessus est décédée le
                </label>
                <includeIf velocityTest="$certificate">
                    <encounterDate showTime="true"/>
                </includeIf>
            </p>

            <br/>
            <p>
                I. <uimessage code="cause_of_death"/>
                <br/>
                <obs conceptId="PIH: Final disease resulting in death"
                     answerClasses="Diagnosis, Symptom" style="autocomplete"/>
                <br/>
                <label><uimessage code="due_to_or_following"/></label>
                <br/>
                <obs conceptId="PIH: Condition causing the final disease"
                     answerClasses="Diagnosis, Symptom" style="autocomplete"/>
                <br/>
                <label><uimessage code="due_to_or_following"/></label>
                <br/>
                <obs conceptId="PIH: Condition causing the final disease"
                     answerClasses="Diagnosis, Symptom" style="autocomplete"/>
            </p>

            <br/>
            <p>
                II. <label><uimessage code="contributing_condition"/></label>
                <obs conceptId="PIH: Condition contributing to the death"
                     answerClasses="Diagnosis, Symptom" style="autocomplete"/>
            </p>

            <br/>
            <p>
                <label><uimessage code="diagnosis_method"/></label>
                <p>
                    <obs conceptId="PIH: Method of confirming death" answerConceptId="PIH: SURGERY"/>
                </p>
                <p>
                    <obs conceptId="PIH: Method of confirming death" answerConceptId="PIH: Autopsy"/>
                </p>
            </p>
        </section>

        <section id="extra-institutional-view" sectionTag="fieldset" headerTag="legend" headerStyle="title" headerCode="info_source">
            <p>
                <obs conceptId="PIH: Source of information" answerConceptId="PIH: OTHER FAMILY MEMBER"/>
            </p>
            <p>
                <obs conceptId="PIH: Source of information" answerConceptId="PIH: Police"/>
            </p>
            <p>
                <obs conceptId="PIH: Source of information" answerConceptId="PIH: Undertaker"/>
            </p>
            <p>
                <obs conceptId="PIH: Source of information" answerConceptId="PIH: OTHER NON-CODED"/>
            </p>
            <p>
                <br/>
                <label><uimessage code="circumstances"/></label>
                <br/>
                <obs conceptId="PIH: Circumstances of death" style="textarea" rows="4" cols="80"/>
            </p>
            <p>
                <excludeIf velocityTest="$certificate">
                    <br/>
                    <label><uimessage code="date_of_death"/></label>
                    <encounterDate showTime="true"/>
                </excludeIf>
            </p>
        </section>

        <section id="permit" sectionTag="div" headerTag="div">
            <p>
                <label><uimessage code="burial_certificate"/></label>
                <obs conceptId="PIH: Burial certificate" />
            </p>
            <p>
                <label><uimessage code="icd_code"/></label>
                TODO
            </p>
        </section>

        <div style="clear:both; height: 1px;"></div>
    </ifMode>

    <p style="display: none">
        <label><uimessage code="encounter_location"/></label>
        <encounterLocation default="SessionAttribute:emrContext.sessionLocationId"/>
    </p>

    <ifMode mode="VIEW" include="false">

        <section id="death" sectionTag="section" headerStyle="title" headerCode="death_details">
            <fieldset>
                <legend><uimessage code="death_details"/></legend>
                <p>
                    <label><uimessage code="date_of_death"/></label>
                    <encounterDate showTime="true" default="now"/>
                </p>
                <p>
                    <label><uimessage code="data_collected_by"/></label>
                    <encounterProviderAndRole default="currentUser" encounterRole="4f10ad1a-ec49-48df-98c7-1391c6ac7f05" required="true"/>
                </p>
            </fieldset>
        </section>

        <section id="demographics" sectionTag="section" headerStyle="title" headerCode="demographics">

            <fieldset>
                <legend>Verify</legend>
                <p>
                    <label>
                        Please verify the name, sex, age/birthdate, and address, and make any corrections necessary to the patient record.
                        <br/>
                        <br/>
                        Press Enter to continue
                    </label>
                    <input type="hidden"/>
                </p>
            </fieldset>

            <fieldset>
                <legend><uimessage code="habitat"/></legend>
                <p class="radio">
                    <label><uimessage code="habitat"/></label>
                    <obs conceptId="PIH: Classification of residential environment" size="2"/>
                </p>
            </fieldset>

            <fieldset>
                <legend><uimessage code="civil_status"/></legend>
                <p>
                    <label><uimessage code="civil_status"/></label>
                    <obs conceptId="PIH: CIVIL STATUS" size="15"/>
                </p>
            </fieldset>

            <fieldset>
                <legend>Occupation</legend>
                <p>
                    <label>Occupation</label>
                    <obs conceptId="PIH: Occupation" size="27"/>
                </p>
            </fieldset>

            <fieldset>
                <legend><uimessage code="maternal_death"/></legend>
                <p>
                    <label><uimessage code="maternal_death"/></label>
                    <obs conceptId="PIH: Maternal death" size="2"/>
                </p>
            </fieldset>
        </section>

        <section id="location" sectionTag="section" headerStyle="title" headerCode="location">
            <fieldset>
                <legend>Place</legend>

                <p>
                    <label>Place</label>
                    <obs id="deathLocation" conceptId="PIH: Location of death" answerConceptIds="PIH: HOSPITAL,PIH: Home,PIH: OTHER NON-CODED" size="3">
                        <controls>
                            <when value="PIH: HOSPITAL"
                                  thenJavaScript="htmlForm.simpleUi.showQuestion('if-institutional')"
                                  elseJavaScript="htmlForm.simpleUi.hideQuestion('if-institutional')"/>
                            <when value="PIH: OTHER NON-CODED"
                                  thenJavaScript="htmlForm.simpleUi.showField('if-other')"
                                  elseJavaScript="htmlForm.simpleUi.hideField('if-other')"/>
                        </controls>
                    </obs>
                </p>
                <p id="if-other">
                    <label>Other</label>
                    <obsTODO conceptId="PIH: Location of death non coded"/>
                </p>
            </fieldset>

            <fieldset id="if-institutional">
                <legend><uimessage code="if_internal"/></legend>
                <p>
                    <label><uimessage code="service"/></label>
                    <obsTODO conceptId="PIH: Location of institutional death" style="location"/>
                </p>

                <p>
                    <label><uimessage code="days_in_hospital"/></label>
                    <obs conceptId="PIH: Duration of hospitalization"/> TODO change this
                </p>
            </fieldset>
        </section>

        <section id="care" sectionTag="section" headerStyle="title" headerCode="Received care">
            <fieldset>
                <legend>Received care</legend>

                <p>
                    <label><uimessage code="doctor_visit"/></label>
                    <obs id="seenByDoctor" conceptId="PIH: Visited provider during illness" style="dropdown" size="3">
                        <controls>
                            <when value="PIH: YES"
                                  thenJavaScript="htmlForm.simpleUi.showSection('certificat-constat')"
                                  elseJavaScript="htmlForm.simpleUi.hideSection('certificat-constat')"/>
                            <when value="PIH: NO"
                                  thenJavaScript="htmlForm.simpleUi.showSection('source-circumstances')"
                                  elseJavaScript="htmlForm.simpleUi.hideSection('source-circumstances')"/>
                        </controls>
                    </obs>
                </p>
            </fieldset>
        </section>

        <section id="certificat-constat" sectionTag="section" headerStyle="title" headerCode="death_certificate">
            <!-- TBD:  provider, signature, role, HUM department, date/time of death, patient died,
                address, telephone, printing, ICD10 code
            -->
            <fieldset>
                <legend><uimessage code="cause_of_death"/></legend>
                <p>
                    <label><uimessage code="final_disease"/></label>
                    <obs conceptId="PIH: Final disease resulting in death"
                         answerClasses="Diagnosis, Symptom" style="autocomplete"/>
                </p>
                <p>
                    <label><uimessage code="due_to_or_following"/></label>
                    <obs conceptId="PIH: Condition causing the final disease"
                         answerClasses="Diagnosis, Symptom" style="autocomplete"/>
                </p>
                <p>
                    <label><uimessage code="due_to_or_following"/></label>
                    <obs conceptId="PIH: Condition causing the final disease"
                         answerClasses="Diagnosis, Symptom" style="autocomplete"/>
                    <br/>
                    <span style="color:red">
                        Testing note: please test to make sure the order of these is preserved (it might not be)
                    </span>
                </p>
            </fieldset>
            <fieldset>
                <legend><uimessage code="contributing_condition_title"/></legend>
                <p>
                    <label><uimessage code="contributing_condition"/></label>
                    <obs conceptId="PIH: Condition contributing to the death"
                         answerClasses="Diagnosis, Symptom" style="autocomplete"/>
                </p>
            </fieldset>
            <fieldset>
                <legend><uimessage code="diagnosis_method"/></legend>
                <p>
                    <label><lookup expression="fn.getConcept('PIH: SURGERY').name"/></label>
                    <obs conceptId="PIH: Method of confirming death" answerConceptId="PIH: SURGERY"/>
                </p>
                <p>
                    <label><lookup expression="fn.getConcept('PIH: Autopsy').name"/></label>
                    <obs conceptId="PIH: Method of confirming death" answerConceptId="PIH: Autopsy"/>
                </p>
            </fieldset>
        </section>

        <section id="source-circumstances" sectionTag="section" headerStyle="title" headerCode="info_source">
            <fieldset>
                <legend><uimessage code="info_source"/></legend>
                <p>
                    <label><uimessage code="info_source"/></label>
                    <obs conceptId="PIH: Source of information" style="dropdown" size="5"
                         answerConceptIds="PIH: OTHER FAMILY MEMBER, PIH: Police, PIH: Undertaker, PIH: OTHER NON-CODED"/>
                </p>
                <p>
                    <label><uimessage code="circumstances"/></label>
                    <obs conceptId="PIH: Circumstances of death" style="textarea" rows="4" cols="75"/>
                </p>
            </fieldset>
        </section>

        <section id="burial" sectionTag="section" headerStyle="title" headerCode="burial_certificate">
            <fieldset>
                <legend><uimessage code="burial_certificate"/></legend>
                <p>
                    <label><uimessage code="burial_certificate"/></label>
                    <obs conceptId="PIH: Burial certificate" />
                </p>
            </fieldset>
        </section>

        <markPatientDead causeOfDeathFromObs="PIH: Final disease resulting in death"/>

    </ifMode>
</htmlform>